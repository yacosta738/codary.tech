---
import { getCollection } from "astro:content";
import { mapArticles } from "@models/EntryMapper";
import ArticleCard from "../../components/ArticleCard.astro";
import Layout from "../../layouts/Layout.astro";

export async function getStaticPaths() {
	const categories = await getCollection("categories");
	return categories.map((cat) => {
		const category = cat.id;
		return {
			params: { category },
			props: { title: cat.data.title },
		};
	});
}

const { title } = Astro.props;
const { category } = Astro.params;

const allArticles = await getCollection("articles", ({ data }) => 
  data.category?.id === category
);
const articles = await mapArticles(allArticles);
---

<Layout title={title} description={`Artículos sobre ${category}`}>
  <div class="max-w-4xl mx-auto">
    <h1 class="text-3xl font-bold text-gray-900 mb-6">{category}</h1>

    <div class="space-y-8">
      {articles.length > 0 ? (
        articles.map(article => <ArticleCard {...article} />)
      ) : (
        <p class="text-gray-600 text-center py-8">
          No hay artículos disponibles en esta categoría.
        </p>
      )}
    </div>
  </div>
</Layout>
