---
import { getCollection } from "astro:content";
import ArticleCard from "@components/ArticleCard.astro";
import Layout from "@layouts/Layout.astro";
import { mapArticles } from "@models/EntryMapper";

export async function getStaticPaths() {
	const tags = await getCollection("tags");
	return tags.map((articleTag) => {
		const tag = articleTag.id;
		return {
			params: { tag },
			props: { title: articleTag.data.title },
		};
	});
}

const { title } = Astro.props;
const { tag } = Astro.params;

const allArticles = await getCollection("articles", ({ data }) => 
  data.tags?.some(currentTag => currentTag.id === tag)
);
const articles = await mapArticles(allArticles);
---

<Layout title={title} description={`Artículos sobre ${title}`}>
  <div class="max-w-4xl mx-auto">
    <h1 class="text-3xl font-bold text-gray-900 mb-6">{title}</h1>

    <div class="space-y-8">
      {articles.length > 0 ? (
        articles.map(article => <ArticleCard {...article} />)
      ) : (
        <p class="text-gray-600 text-center py-8">
          No hay artículos disponibles con esta etiqueta.
        </p>
      )}
    </div>
  </div>
</Layout>
